<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script></script>
    <title>Player POC</title>
</head>
<body>
<div data-video-src="https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8"></div>
<script type="module" src="./src/main.tsx"></script>
<script>
    function doThingsWithCookies() {
        document.cookie = "foo=bar;samesite=none;secure"
    }

    const requestAccess = async () => {
      try {
        await fetch('/', {method: 'POST', body: {hello: 'hello'}})
        await document.requestStorageAccess();
        doThingsWithCookies();
      } catch (err) {
        // If there is an error obtaining storage access.
        console.error(`Error obtaining storage access: ${err}. Please sign in.`);
      }
    }
    async function handleCookieAccess() {
        if (!document.hasStorageAccess) {
            doThingsWithCookies();
        } else {
          const hasAccess = await document.hasStorageAccess();
            if (hasAccess) {
                // We have access to third-party cookies, so let's go
                doThingsWithCookies();
            } else {
              try {
                await requestAccess()
              } catch (err) {
                console.error(`Error obtaining storage access: ${err}.  Please sign in.`);
              }
                // document.addEventListener('click', async () => {
                //     try {
                //         await document.requestStorageAccess();
                //         doThingsWithCookies();
                //     } catch (err) {
                //         // If there is an error obtaining storage access.
                //         console.error(`Error obtaining storage access: ${err}.
                //             Please sign in.`);
                //     }
                // });
            }
        }
    }

    handleCookieAccess().then(() => console.log("called")).catch((err) => console.log('something went wrong', err))

</script>
</body>
</html>
